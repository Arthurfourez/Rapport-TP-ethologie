---
title: "Etude du comportement et de la morphologie des bourdons"
author: "Arthur Fourez, Maréva Fontaine, Leonie Nguemguo Kalamo"
date: "2023-10-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

## Objectifs

## Matériels et méthodes

## Résultats

```{r}
SciViews::R("model", lang = "fr")
```

```{r}
Bourdon_tab <- read$csv("Documents/TP bourdons - Fiche.csv")
library(ggplot2)
library(markovchain)
```

```{r}
test1 = c("M","M","M","M","M","M","M","M","M","M","T","T","T","M","M","NA","M","I","I","M","M","I","M","Po","Po","M","I","I","I","M","M","M","M","M","Co","Co","M","M","I","I","M","M","Co","Co","I","I","T","T","M","M","I","T","M","M","I","I","I","M","NA","NA")
test2 = c("I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","I","M")
test3 = c("M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","T","M","M","M","M","M","C","M","M","L","M","M","M","M","M","M","M","I","M","M","M","M","M","M","I","M","M","I","T","M","I","T","M","M","M","I","I","M","M","M","NA")
test4 = c("M","M","B","B","B","M","M","B","M","M","M","B","M","M","M","B","B","A","M","M","M","I","A","A","M","M","M","M","M","I","N","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","A","M","M","M","M","M","M","NA","NA","NA")
test5 = c("M","M","M","M","P","C","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","M","P","M","M","Pt","I","M","M","M","M","C","M","M","M","M","M","M","M","C","I","I","I","Pt","Pt","Pt","Pt","M","NA","NA","NA","NA","NA","NA")
test6 = c("C","M","M","M","L","L","M","M","M","D","I","M","M","M","M","M","M","M","C","Pt","M","M","M","M","M","M","C","M","Pt","M","M","M","M","M","M","I","I","M","M","I","M","M","M","I","I","I","I","T","M","M","M","M","M","NA","NA","NA","NA","NA","NA","NA")
```

```{r}
compte1 = cbind(as.data.frame(table(test1)),rep("R�plica 1",nrow(table(test1))),rep("Exp�rience 1",nrow(table(test1))))
colnames(compte1) = c("Etho","Freq","Rep","Exp")
compte2 = cbind(as.data.frame(table(test2)),rep("R�plica 2",nrow(table(test2))),rep("Exp�rience 1",nrow(table(test2))))
colnames(compte2) = c("Etho","Freq","Rep","Exp")
compte3 = cbind(as.data.frame(table(test3)),rep("R�plica 1",nrow(table(test3))),rep("Exp�rience 2",nrow(table(test3))))
colnames(compte3) = c("Etho","Freq","Rep","Exp")
compte4 = cbind(as.data.frame(table(test4)),rep("R�plica 2",nrow(table(test4))),rep("Exp�rience 2",nrow(table(test4))))
colnames(compte4) = c("Etho","Freq","Rep","Exp")
compte5 = cbind(as.data.frame(table(test5)),rep("R�plica 1",nrow(table(test5))),rep("Exp�rience 3",nrow(table(test5))))
colnames(compte5) = c("Etho","Freq","Rep","Exp")
compte6 = cbind(as.data.frame(table(test6)),rep("R�plica 2",nrow(table(test6))),rep("Exp�rience 3",nrow(table(test6))))
colnames(compte6) = c("Etho","Freq","Rep","Exp")
```

```{r}
dataset = rbind(compte1,compte2,compte3,compte4,compte5,compte6)
```

```{r}
ggplot(dataset, aes(x = Etho, y = Freq, fill = Exp)) +
  geom_col(position = "dodge") + ggtitle("Comportement de la colonie") +
  labs(x ="Actes comportementaux", y = "Occurences")
```

*Fig*.1. Ce graphique permet de se rendre compte du nombre d'apparition d'un comportement lors de nos divers test.

```{r}
p <- ggplot(data = dataset, aes(x = Etho, y = Freq, fill = Rep)) + scale_fill_grey()
p <- p + geom_col(width = 1, position = position_dodge2(width = 0.9, preserve = "single"))
p <- p + facet_grid(. ~ Exp)+ ggtitle("Comportement de la colonie") +
  labs(x ="Actes comportementaux", y = "Occurences")+theme_bw()+ theme(plot.title = element_text(hjust = 0.5))
p
```

*Fig*.2. Ce graphique permet comme le précédent de voir l'occurrence de nos observation mais aussi de comparer les deux réplicas réalisés pour chaque test.

```{r}
markov1 <- function (seq){
  seq = seq[!is.na(seq)]
  l = length(unique(seq)) 
  m = matrix(nrow = l, ncol = l) 
  rownames(m)= unique(seq)[order(unique(seq))] 
  colnames(m)= unique(seq)[order(unique(seq))]
  transition <-function(x,y){ 
    previous = 0 
    for (i in seq) { 
      if (i == x & previous == y) 
        a = a+1 
      }
      previous = i 
    }
    return(a) 
}

```

```{r}
for (row in 1:nrow(m)){ # Pour chaque ligne de la matrice.
    for (col in 1:ncol(m)) { # Et pour chaque colonne,
      m[row,col]=transition(rownames(m)[row],colnames(m)[col]) # L'�l�ment correspondant � la ligne et � la colonne  = r�sultat de la fonction interm�diaire pour les noms de ligne et de colonne correspondant
    }
  }
  
  return(m) # On sauve la matrice
}
```

```{r}
transition<-markov1(test1)
```

```{r}
markov1pourcent <- function (m){
  m2 = m 
  for (row in 1:nrow(m2)){ 
    for (col in 1:ncol(m2)) { 
      m2[row,col]=m[row,col]/sum(m[,col]) 
    }
  }
  m2[is.na(m2)] <- 0 
  return (m2) 
}
```

```{r}
transitionpourcent <- markov1pourcent(transition)
```

```{r}
library(markovchain)
```

```{r}
markov <- new('markovchain',
  transitionMatrix = t(transitionpourcent), # On doit prendre la transpos�e
  states = c("a","b","c","d"))
```

```{r}
plot(markov,
  edge.arrow.size = 0.25, edge.arrow.width = 1,edge.color ="grey",edge.lty = 1,
  edge.label.cex = 1,edge.label.color = "black",
  vertex.color = "lightgreen", vertex.shape = "circle",vertex.size = 10*table(test1),
  vertex.frame.color= NA,
  vertex.label.color ="black",vertex.label.cex = 2.5
)
```

```{r}
poidsW = data.frame(poids = (rnorm(300, mean=5, sd=1)))
ggplot(data = poidsW, mapping = aes(x =poids)) + geom_histogram()
```

## Discussion

## Bibliographie
